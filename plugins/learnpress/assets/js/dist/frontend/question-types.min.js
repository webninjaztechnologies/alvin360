(()=>{"use strict";var e={d:(s,t)=>{for(var n in t)e.o(t,n)&&!e.o(s,n)&&Object.defineProperty(s,n,{enumerable:!0,get:t[n]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},s={};e.r(s),e.d(s,{FillInBlanks:()=>f,MultipleChoices:()=>w,QuestionBase:()=>u,SingleChoice:()=>d,TrueOrFalse:()=>y,default:()=>C});const t=window.wp.element,n=window.wp.compose,r=window.wp.data,i=window.wp.i18n,o=window.ReactJSXRuntime,{isArray:a,get:p,set:l}=lodash;class c extends t.Component{constructor(e){super(...arguments);const{question:s}=e;this.state={optionClass:["answer-option"],questionId:0,options:s?this.parseOptions(s.options):[],self:this},e.$wrap&&(this.$wrap=e.$wrap)}static getDerivedStateFromProps(e,s){return s.self.prepare(e,s)}componentDidMount(){const e=this.prepare(this.props,this.state);e&&this.setState(e)}prepare=(e,s)=>{const{question:t}=e;return t&&t.id!==s.questionId?{options:s.self.parseOptions(t.options)}:null};setInputRef=(e,s)=>{this.inputs||(this.inputs={}),this.inputs[s]=e};maybeShowCorrectAnswer=()=>{const{status:e,isCheckedAnswer:s,showCorrectReview:t,isReviewing:n}=this.props;return"completed"===e&&t||s&&!n};maybeDisabledOption=e=>{const{answered:s,status:t,isCheckedAnswer:n}=this.props;return n||"started"!==t};setAnswerChecked=()=>e=>{const{updateUserQuestionAnswers:s,question:t,status:n}=this.props;if("started"!==n)return(0,i.__)("LP Error: can not set answers","learnpress");const r=this.$wrap.find(".option-check"),o=[],a="multi_choice"!==t.type;r.each(((e,s)=>{if(s.checked&&(o.push(s.value),a))return!1})),s(t.id,a?o[0]:o)};maybeCheckedAnswer=e=>{const{answered:s}=this.props;return a(s)?!!s.find((s=>s==e)):e==s};getOptionType=(e,s)=>{let t="radio";return"multi_choice"===e&&(t="checkbox"),t};isDefaultType=()=>this.props.supportOptions;getWarningMessage=()=>(0,o.jsx)(o.Fragment,{children:(0,i.__)("The render function should be overwritten from the base.","learnpress")});getOptionClass=e=>{const{answered:s}=this.props;return["answer-option"]};parseOptions=e=>(e&&(e=a(e)?e:JSON.parse(CryptoJS.AES.decrypt(e.data,e.key,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),e=a(e)?e:JSON.parse(e)),e||[]);getOptions=()=>this.state.options||[];isCorrect=()=>{const{answered:e}=this.props;if(!e)return!1;let s,t,n;for(s=0,n=this.getOptions();s<n.length;s++)if(t=n[s],"yes"===t.isTrue&&e==t.value)return!0;return!1};isChecked=()=>{const{question:e}=this.props;return(0,r.select)("learnpress/quiz").isCheckedAnswer(e.id)};getCorrectLabel=()=>{const{status:e,answered:s,question:t}=this.props,n=(LP.config.isQuestionCorrect[t.type]||this.isCorrect).call(this);return this.maybeShowCorrectAnswer()&&(0,o.jsxs)("div",{className:"question-response"+(n?" correct":" incorrect"),children:[(0,o.jsx)("span",{className:"label",children:n?(0,i.__)("Correct","learnpress"):(0,i.__)("Incorrect","learnpress")}),(0,o.jsx)("span",{className:"point",children:sprintf((0,i.__)("%d/%d point","learnpress"),n?t.point:0,t.point)})]})};render(){const{question:e,status:s}=this.props;return(0,o.jsxs)("div",{className:"question-answers",children:[this.isDefaultType()&&(0,o.jsx)("ul",{id:`answer-options-${e.id}`,className:"answer-options",children:this.getOptions().map((t=>{const n=`learn-press-answer-option-${t.uid}`;return(0,o.jsxs)("li",{className:this.getOptionClass(t).join(" "),children:[(0,o.jsx)("input",{type:this.getOptionType(e.type,t),className:"option-check",name:"started"===s?`learn-press-question-${e.id}`:"",id:n,ref:e=>{this.setInputRef(e,t.value)},onChange:this.setAnswerChecked(),disabled:this.maybeDisabledOption(t),checked:this.maybeCheckedAnswer(t.value),value:"started"===s?t.value:""}),(0,o.jsx)("label",{htmlFor:n,className:"option-title",dangerouslySetInnerHTML:{__html:t.title||t.value}})]},`answer-option-${t.uid}`)}))}),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel()]})}}const u=c,d=class extends u{getOptionClass=e=>{const{answered:s}=this.props,t=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&t.push("answer-correct"),s&&("yes"===e.isTrue?s===e.value&&t.push("answered-correct"):s===e.value&&t.push("answered-wrong"))),t}},{isBoolean:h}=lodash,w=class extends u{isCorrect=()=>{const{answered:e}=this.props;if(h(e)||!e)return!1;let s,t,n;for(s=0,n=this.getOptions();s<n.length;s++)if(t=n[s],"yes"===t.isTrue){if(-1===e.indexOf(t.value))return!1}else if(-1!==e.indexOf(t.value))return!1;return!0};getOptionClass=e=>{const{answered:s}=this.props,t=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&t.push("answer-correct"),s&&("yes"===e.isTrue?-1!==s.indexOf(e.value)&&t.push("answered-correct"):-1!==s.indexOf(e.value)&&t.push("answered-wrong"))),t}},y=class extends u{getOptionClass=e=>{const{answered:s}=this.props,t=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&t.push("answer-correct"),s&&("yes"===e.isTrue?s===e.value&&t.push("answered-correct"):s===e.value&&t.push("answered-wrong"))),t}};let m=!1;const f=class extends u{componentDidMount(){const{answered:e,question:s}=this.props;e&&[...document.querySelectorAll(".lp-fib-input > input")].map((t=>{parseInt(t.closest(".question").dataset.id)===s.id&&e[t.dataset.id]&&(t.value=e[t.dataset.id])})),this.updateFibAnswer()}componentDidUpdate(e){e.answered||this.updateFibAnswer()}updateFibAnswer=()=>{m||document.addEventListener("input",(e=>{const s=e.target;if(s.closest(".lp-fib-input")){const e=s.closest(".question-fill_in_blanks").dataset.id;this.setAnswered(e,s.dataset.id,s.value)}})),m=!0};setAnswered=(e,s,t)=>{const{updateUserQuestionFibAnswers:n,question:r,status:i}=this.props;if("started"!==i)return"LP Error: can not set answers";n(e,s,t)};getCorrectLabel=()=>{const{question:e,mark:s}=this.props;let t=s||0;return s&&(Number.isInteger(s)||(t=s.toFixed(2))),this.maybeShowCorrectAnswer()&&(0,o.jsxs)("div",{className:"question-response correct",children:[(0,o.jsx)("span",{className:"label",children:(0,i.__)("Points","learnpress")}),(0,o.jsx)("span",{className:"point",children:`${t}/${e.point} ${(0,i.__)("point","learnpress")}`}),(0,o.jsxs)("span",{className:"lp-fib-note",children:[(0,o.jsx)("span",{style:{background:"#00adff"}}),(0,i.__)("Correct","learnpress")]}),(0,o.jsxs)("span",{className:"lp-fib-note",children:[(0,o.jsx)("span",{style:{background:"#d85554"}}),(0,i.__)("Incorrect","learnpress")]})]})};convertInputField=e=>{const{answered:s,isReviewing:t,showCorrectReview:n,isCheckedAnswer:r}=this.props;let i=e.title;const o=e?.answers;return e.ids.map(((e,a)=>{const p="{{FIB_"+e+"}}";let l="";const c=o?o?.[e]:void 0;var u,d;c||t?(l+=`<span class="lp-fib-answered ${(n||r)&&c?.correct?c?.isCorrect?"correct":"fail":""}">`,c?.isCorrect||(l+=`<span class="lp-fib-answered__answer">${null!==(d=s?.[e])&&void 0!==d?d:""}</span>`),!c?.isCorrect&&c?.correct&&(l+=" â†’ "),l+=`<span class="lp-fib-answered__fill">${null!==(u=c?.correct)&&void 0!==u?u:""}</span>`,l+="</span>"):(l+='<div class="lp-fib-input" style="display: inline-block; width: auto;">',l+='<input type="text" data-id="'+e+'" value="" />',l+="</div>");i=i.replace(p,l)})),i};render(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"lp-fib-content",children:this.getOptions().map((e=>(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:this.convertInputField(e)||e.value}},`blank-${e.uid}`)))}),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel()]})}};class g extends t.Component{getQuestion=()=>{const{question:e}=this.props;return LP.Hook.applyFilters("question-types",{single_choice:LP.questionTypes.SingleChoice,multi_choice:LP.questionTypes.MultipleChoices,true_or_false:LP.questionTypes.TrueOrFalse,fill_in_blanks:LP.questionTypes.FillInBlanks})[e.type]};render(){const{question:e,supportOptions:s}=this.props,t={...this.props};t.supportOptions=-1!==s.indexOf(e.type);const n=this.getQuestion()||function(){return(0,o.jsx)("div",{className:"question-types",dangerouslySetInnerHTML:{__html:(0,i.sprintf)((0,i.__)("Question <code>%s</code> invalid!","learnpress"),e.type)}})};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(n,{...t})})}}const C=(0,n.compose)((0,r.withSelect)(((e,{question:{id:s}})=>{const{getData:t,isCheckedAnswer:n}=e("learnpress/quiz");return{supportOptions:t("supportOptions"),isCheckedAnswer:n(s),keyPressed:t("keyPressed"),showCorrectReview:t("showCorrectReview"),isReviewing:"reviewing"===t("mode")}})),(0,r.withDispatch)((()=>({}))))(g);(window.LP=window.LP||{}).questionTypes=s})();