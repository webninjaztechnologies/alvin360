jQuery(document).ready(function(){var jq=jQuery;jq(document).on('click','#mpp-check-all',function(){if(jq(this).is(':checked')){jq('input.mpp-delete-media-check').prop('checked',!0)}else{jq('input.mpp-delete-media-check').prop('checked',!1)}});jq(document).on('click','.mpp-publish-to-activity-button',function(){var $this=jq(this);var url=$this.attr('href');var gallery_id=get_var_in_url('gallery_id',url);var nonce=get_var_in_url('_wpnonce',url);jq.post(ajaxurl,{action:'mpp_publish_gallery_media',gallery_id:gallery_id,_wpnonce:nonce,cookie:encodeURIComponent(document.cookie)},function(response){var error;if(response.error!==undefined){error=1}
jq('#mpp-unpublished-media-info').hide();mpp.notify(response.message,error)},'json');return!1});jq(document).on('click','.mpp-delete-unpublished-media-button',function(){var $this=jq(this);var url=$this.attr('href');var gallery_id=get_var_in_url('gallery_id',url);var nonce=get_var_in_url('_wpnonce',url);jq.post(ajaxurl,{action:'mpp_hide_unpublished_media',gallery_id:gallery_id,_wpnonce:nonce,cookie:encodeURIComponent(document.cookie)},function(response){var error;if(typeof response.error!=="undefined"){error=1}
jq('#mpp-unpublished-media-info').hide();mpp.notify(response.message,error)},'json');return!1});if(jq.fn.sortable!==undefined){jq("#mpp-sortable").sortable({opacity:0.6,cursor:'move'})}
jq('#whats-new-options').prepend(jq('#mpp-activity-upload-buttons'));mpp.activity_uploader=new mpp.Uploader({container:'body',dropzone:'#mpp-upload-dropzone-activity',browser:'#mpp-upload-media-button-activity',feedback:'#mpp-upload-feedback-activity',media_list:'#mpp-uploaded-media-list-activity',uploading_media_list:_.template("<li id='<%= id %>'><span class='mpp-attached-file-name'><%= name %></span>(<span class='mpp-attached-file-size'><%= size %></spa>)<span class='mpp-remove-file-attachment'>x</span> <b></b></li>"),uploaded_media_list:_.template("<li class='mpp-uploaded-media-item' id='mpp-uploaded-media-item-<%= id %>' data-media-id='<%= id %>'><img src='<%= url %>' /><a href='#' class='mpp-delete-uploaded-media-item'>x</a></li>"),success:function(file){mpp.Uploader.prototype.success(file);mpp_add_attached_media(file.get('id'))},error:function(reason,data,file){mpp.Uploader.prototype.error(reason,data,file);_mpp_activity_upload_error()},complete:function(){mpp.Uploader.prototype.complete();_mpp_activity_upload_complete()},onAddFile:function(file){mpp.Uploader.prototype.onAddFile(file)},allFilesAdded:function(up){_mpp_activity_all_files_added()},isRestricted:function(up,file){return!1}});jq(document).on('click','#mpp-activity-upload-buttons a',function(){var el=jq(this);if(jq('#mpp-upload-dropzone-activity').length){var $container=jq('#mpp-upload-dropzone-activity').closest('.mpp-media-upload-container');$container.slideUp('slow',function(){jq(this).removeClass('mpp-upload-container-inactive').addClass('mpp-upload-container-active')});mpp.activity_uploader.param('context','activity');var dropzone=mpp.activity_uploader.dropzone;_mppData.current_type=jq(this).data('media-type');mpp_setup_uploader_file_types(mpp.activity_uploader);dropzone.show();mpp.activity_uploader.refresh();_mppData.activity_disable_auto_file_browser=parseInt(_mppData.activity_disable_auto_file_browser,10);if(!_mppData.activity_disable_auto_file_browser){jq('#mpp-upload-media-button-activity').click()}}
jq('.mpp-remote-add-media-row-activity').show();return!1});jq(document).on('click','.mpp-upload-container-close',function(){hideActivityUploadContainer();return!1});function hideActivityUploadContainer(){var $container=jq('#mpp-activity-media-upload-container');$container.slideDown('slow',function(){jq(this).removeClass('mpp-upload-container-active').addClass('mpp-upload-container-inactive')});return!1}
if(jq('#whats-new-form').get(0)||jq('#swa-whats-new-form').get(0)){jQuery(document).ajaxSend(function(event,jqxhr,settings){if(is_post_update(settings.data)){var attached_media=mpp_get_attached_media();if(attached_media){settings.data=settings.data+'&mpp-attached-media='+attached_media;mpp_reset_attached_media()}}});jq(document).ajaxComplete(function(evt,xhr,options){var action=get_var_in_query('action',options.data);switch(action){case 'post_update':case 'swa_post_update':hideActivityUploadContainer();mpp.activity_uploader.hide_ui();jq('.mpp-remote-add-media-row-activity').hide();break}})}
function _mpp_activity_all_files_added(){jq('#aw-whats-new-submit').prop('disabled',!0)}
function _mpp_activity_upload_complete(){jq('#aw-whats-new-submit').prop('disabled',!1)}
function _mpp_activity_upload_error(){jq('#aw-whats-new-submit').prop('disabled',!1)}
function is_post_update(qs){if(!qs){return!1}
var action=get_var_in_query('action',qs);if(action==='post_update'||action==='swa_post_update'){return!0}
return!1}
mpp.guploader=new mpp.Uploader({container:'body',dropzone:'#mpp-upload-dropzone-gallery',browser:'#mpp-upload-media-button-gallery',feedback:'#mpp-upload-feedback-gallery',media_list:'#mpp-uploaded-media-list-gallery',uploading_media_list:_.template("<li id='<%= id %>'><span class='mpp-attached-file-name'><%= name %></span>(<span class='mpp-attached-file-size'><%= size %></spa>)<span class='mpp-remove-file-attachment'>x</span> <b></b></li>"),uploaded_media_list:_.template("<li class='mpp-uploaded-media-item' id='mpp-uploaded-media-item-<%= id %>'><img src='<%= url %>' /></li>")});var context='gallery';var gallery_id=0;if(jq('#mpp-context').get(0)){context=jq('#mpp-context').val()}
if(jq('#mpp-upload-gallery-id').get(0)){gallery_id=jq('#mpp-upload-gallery-id').val()}
if(jq('#mpp-upload-dropzone-gallery').get(0)){mpp.guploader.param('context',context);mpp.guploader.param('gallery_id',gallery_id);mpp_setup_uploader_file_types(mpp.guploader)}
mpp.cover_uploader=new mpp.Uploader({container:'body',dropzone:'.mpp-gallery-editable-cover',browser:'#mpp-cover-upload',feedback:'#mpp-cover-gallery-upload-feedback',media_list:'',uploading_media_list:_.template("<li id='<%= id %>'><span class='mpp-attached-file-name'><%= name %></span>(<span class='mpp-attached-file-size'><%= size %></spa>)<span class='mpp-remove-file-attachment'>x</span> <b></b></li>"),uploaded_media_list:_.template("<li class='mpp-uploaded-media-item' id='mpp-uploaded-media-item-<%= id %>'><img src='<%= url %>' /></li>"),complete:function(){},success:function(file){var sizes=file.get('sizes');var original_url=file.get('url');var id=file.get('id');var file_obj=file.get('file');var thumbnail=sizes.thumbnail;var cover='#mpp-cover-'+file.get('parent_id');jq(cover).find('.mpp-cover-uploading').hide();jq(cover).find('img.mpp-cover-image').attr('src',thumbnail.url)},clear_media_list:function(){},clear_feedback:function(){if(!this.feedback){return}
jq('ul',this.feedback).empty()},hide_dropzone:function(){if(!this.dropzone){return}
jq(this.dropzone).hide()},hide_ui:function(){this.clear_media_list();this.clear_feedback();this.hide_dropzone()},onAddFile:function(file){this.param('context','cover');this.param('action','mpp_upload_cover');var parent=this.browser.parents('.mpp-cover-wrapper');this.param('mpp-parent-id',parent.find('.mpp-parent-id').val());this.param('mpp-gallery-id',parent.find('.mpp-gallery-id').val());this.param('mpp-parent-type',parent.find('.mpp-parent-type').val());parent.find('.mpp-cover-uploading').show()},init:function(){var parent=this.browser.parents('.mpp-cover-wrapper');jq.each(parent,function(){jq(this).find('.mpp-gallery-editable-cover').append(jq('#mpp-cover-uploading').clone())})}});mpp.shortcode_uploader=new mpp.Uploader({container:'body',dropzone:'#mpp-upload-dropzone-shortcode',browser:'#mpp-upload-media-button-shortcode',feedback:'#mpp-upload-feedback-shortcode',media_list:'#mpp-uploaded-media-list-shortcode',uploading_media_list:_.template("<li id='<%= id %>'><span class='mpp-attached-file-name'><%= name %></span>(<span class='mpp-attached-file-size'><%= size %></spa>)<span class='mpp-remove-file-attachment'>x</span> <b></b></li>"),uploaded_media_list:_.template("<li class='mpp-uploaded-media-item' id='mpp-uploaded-media-item-<%= id %>'><img src='<%= url %>' /></li>"),onAddFile:function(file){this.param('context','shortcode');var parent=this.browser.parents('.mpp-upload-shortcode');var $gallery=parent.find('#mpp-shortcode-upload-gallery-id');var $skip_check=parent.find('#mpp-shortcode-skip-gallery-check');if(!$skip_check.get(0)&&(!$gallery.get(0)||$gallery.val()==0)){this.uploader.removeFile(file);this.refresh();this.removeFileFeedback(file);this.uploader.stop();mpp.notify("Please select a gallery before uploading.",1)}
this.param('gallery_id',parent.find('#mpp-shortcode-upload-gallery-id').val());jq('.mpp-loader',this.media_list).show()}});if(jq('#mpp-upload-dropzone-shortcode').get(0)){var $type=jq('#mpp-upload-dropzone-shortcode').parents('.mpp-upload-shortcode').find('.mpp-uploading-media-type');if($type.get(0)){mpp_setup_uploader_file_types(mpp.shortcode_uploader,$type.val())}}
jQuery('.mpp-upload-shortcode #mpp-shortcode-upload-gallery-id').change(function(){var $option=jQuery(this).find("option:selected");mpp_setup_uploader_file_types(mpp.shortcode_uploader,$option.data('mpp-type'))});jq(document).on('click','.mpp-uploading-media-list .mpp-delete-uploaded-media-item',function(){var $this=jq(this);var $parent=jq($this.parent());var id=$parent.data('media-id');if(!id){return!1}
var $img=$parent.find('img');var old_image=$img.attr('src');$img.attr('src',_mppData.loader_src);$this.hide();var nonce=jq('#_mpp_manage_gallery_nonce').val();jq.post(ajaxurl,{action:'mpp_delete_media',media_id:id,cookie:encodeURIComponent(document.cookie),_wpnonce:nonce},function(response){if(typeof response.success!=="undefined"){$parent.remove();mpp_remove_attached_media(id);mpp.notify(response.message)}else{$this.show();$img.attr('src',old_image);mpp.notify(response.message)}},'json');return!1});if(mpp.notify===undefined){mpp.notify=function(message,error){var class_name='updated success';if(error!==undefined){class_name='error'}
jq('#mpp-notice-message').remove();var selectors=['#mpp-container','#whats-new-form','.mpp-upload-shortcode'];var container_selector='';for(var i=0;i<selectors.length;i++){if(jQuery(selectors[i]).get(0)){container_selector=selectors[i];break}}
if(container_selector){jq(container_selector).prepend('<div id="mpp-notice-message" class="mpp-notice mpp-template-notice '+class_name+'"><p>'+message+'</p></div>').show()}};mpp.clearNotice=function(){jQuery('#mpp-notice-message').remove()}}
mpp.lightbox={open:function(items,position,fallback_url){if(items.length<1){window.location=fallback_url;return}
jQuery.magnificPopup.open({items:items,type:'inline',closeBtnInside:!1,preload:[1,3],closeOnBgClick:!0,showCloseBtn:!0,closeMarkup:'<button title="%title%" type="button" class="mfp-close mpp-lightbox-close-btn">&#215;</button>',gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]}},position);jQuery(document).trigger('mpp:lightbox:opened',[items,position]);jQuery(document).trigger('mpp_lightbox_opened')},update:function(content){if(!mpp.lightbox.isLoaded()){return!1}
var magnificPopup=jQuery.magnificPopup.instance;magnificPopup.currItem.src=content;magnificPopup.items[magnificPopup.index]=magnificPopup.currItem;magnificPopup.updateItemHTML()},gallery:function(gallery_id,position,url,media_id){var $lightbox=this;jQuery.post(ajaxurl,{action:'mpp_fetch_gallery_media',gallery_id:gallery_id,cookie:encodeURIComponent(document.cookie)},function(response){if(response.items===undefined){return}
var items=response.items;if(typeof media_id!=='undefined'){position=get_media_position_in_collection(media_id,items)}
$lightbox.open(items,position,url)},'json')},media:function(media_ids,position,url,media_id){var $lightbox=this;jQuery.post(ajaxurl,{action:'mpp_lightbox_fetch_media',media_ids:media_ids,cookie:encodeURIComponent(document.cookie)},function(response){if(response.items===undefined){return}
var items=response.items;if(typeof media_id!=='undefined'){position=get_media_position_in_collection(media_id,items)}
$lightbox.open(items,position,url)},'json')},activity:function(activity_id,position,url,media_id){var $lightbox=this;jQuery.post(ajaxurl,{action:'mpp_fetch_activity_media',activity_id:activity_id,cookie:encodeURIComponent(document.cookie)},function(response){if(response.items===undefined){return}
var items=response.items;if(typeof media_id!=='undefined'){position=get_media_position_in_collection(media_id,items)}
$lightbox.open(items,position,url)},'json')},reloadMedia:function(media_id){var $lightbox=this;jq.post(ajaxurl,{action:'mpp_reload_lightbox_media','media_id':media_id},function(response){if(response.success){$lightbox.update(response.data.content)}else{}})},reloadCurrentMedia:function(){var media_id=this.getCurrentMediaID();if(media_id){this.reloadMedia(media_id);return!0}
return!1},getCurrentMediaID:function(){if(!this.isLoaded()||!this.isOpen()){return 0}
var magnificPopup=jQuery.magnificPopup.instance;var data=magnificPopup.currItem.data;if(typeof data.id!=='undefined'){return data.id}
return 0},isLoaded:function(){return jQuery.fn.magnificPopup!==undefined},isOpen:function(){return jQuery.magnificPopup.instance.isOpen===!0},is_lightbox_loaded:function(){return this.isLoaded()},supportsMediaType:function(type){return!type||!_mppData.lightboxDisabledTypes||!_mppData.lightboxDisabledTypes[type]}};var isLightBoxLoaded=mpp.lightbox.isLoaded();if(isLightBoxLoaded&&_mppData.enable_activity_lightbox){jq(document).on('click.mpp:activity:lightbox.mpp:lightbox','.mpp-activity-media-list a.mpp-activity-media, .mpp-activity-media-list a.mpp-activity-item-title',function(){var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var activity_id=$this.data('mpp-activity-id');var $parent=$this.parents('.mpp-activity-item-content');var position=0;if($parent.get(0)){position=$this.parents('.mpp-container').find('.mpp-activity-item-content').index($parent)}else if(!activity_id&&$this.find('img.mpp-attached-media-item').get(0)){activity_id=$this.find('img.mpp-attached-media-item').data('mpp-activity-id')}
var url=$this.attr('href');if(!activity_id){return!0}
var media_id=$this.data('mpp-media-id');mpp.lightbox.activity(activity_id,position,url,media_id);return!1});jq(document).on('click.mpp:activity:comment:lightbox.mpp:lightbox','.mpp-activity-comment-media-list a',function(){var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var media_id=$this.data('mpp-media-id');var position=0;var url=$this.attr('href');if(!media_id){return!0}
mpp.lightbox.media(media_id,position,url);return!1})}
if(isLightBoxLoaded&&_mppData.enable_gallery_lightbox){jq(document).on('click.mpp:gallery:cover:lightbox.mpp:lightbox','.mpp-gallery a.mpp-gallery-cover',function(){var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var gallery_id=$this.data('mpp-gallery-id');var position=0;var url=$this.attr('href');if(!gallery_id){return!0}
mpp.lightbox.gallery(gallery_id,position,url);return!1})}
if(isLightBoxLoaded){jq(document).on('click.mpp:shortcode:lightbox.mpp:lightbox','.mpp-shortcode-lightbox-enabled a.mpp-media-thumbnail, .mpp-shortcode-lightbox-enabled a.mpp-media-title',function(){var $container=jq(jq(this).parents('.mpp-shortcode-lightbox-enabled').get(0));if(!$container.get(0)){return}
var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var media_ids=$container.data('media-ids');var url=$this.attr('href');var position=0;var media_id=$this.data('mpp-media-id');mpp.lightbox.media(media_ids,position,url,media_id);return!1})}
if(isLightBoxLoaded&&_mppData.enable_lightbox_in_gallery_media_list){jq(document).on('click.mpp:gallery:media:lightbox.mpp:lightbox','.mpp-single-gallery-media-list a.mpp-photo-thumbnail, .mpp-single-gallery-media-list a.mpp-media-title',function(){var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var gallery_id=$this.parents('.mpp-single-gallery-media-list').data('gallery-id');var position=0;var url=$this.attr('href');var media_id=$this.data('mpp-media-id');if(!gallery_id||!media_id){return!0}
mpp.lightbox.gallery(gallery_id,position,url,media_id);return!1})}
if(isLightBoxLoaded){jq(document).on('click.mpp:link:lightbox.mpp:lightbox','.mpp-lightbox-link',function(){var $this=jq(this);if($this.hasClass('mpp-no-lightbox')){return}
if(!mpp.lightbox.supportsMediaType($this.data('mpp-type'))){return}
var activity_id=$this.data('activity-id');var gallery_id=$this.data('gallery-id');var media_id=$this.data('media-id');var url=$this.attr('href');var lightbox_opened=!1;var position=$this.data('position');if(!position){position=0}else{position=position-1}
if(gallery_id){mpp.lightbox.gallery(gallery_id,position,url);lightbox_opened=!0}else if(media_id){mpp.lightbox.media(media_id,position,url);lightbox_opened=!0}else if(activity_id){mpp.lightbox.activity(activity_id,position,url);lightbox_opened=!0}
if(lightbox_opened){return!1}})}
function get_media_position_in_collection(media_id,items){var index=0;var position=0;for(var i in items){if(items[i].id==media_id){position=index}
index++}
return position}
function mpp_ligtbox_show_edit_error(form,message){var $el=form.find('.mpp-lightbox-edit-error');if(!$el.get(0)){form.prepend("<div class='mpp-error mpp-lightbox-edit-error'></div>");$el=form.find('.mpp-lightbox-edit-error')}
$el.html('<p>'+message+'</p>')}
function mpp_lightbox_hide_edit_error(form){form.find('.mpp-lightbox-edit-error').remove()}
jq(document).on('click','.mpp-lightbox-edit-media-link',function(){var $this=jq(this);$this.hide();var $form=jq('#mpp-lightbox-media-edit-form-'+$this.data('mpp-media-id'));$form.removeClass('mpp-form-hidden');jq('.mpp-lightbox-edit-media-cancel-link').show();jq('.mpp-lightbox-media-description').hide();return!1});jq(document).on('click','.mpp-lightbox-edit-media-cancel-link',function(){var $this=jq(this);var $form=jq('#mpp-lightbox-media-edit-form-'+$this.data('mpp-media-id'));$form.addClass('mpp-form-hidden');$this.hide();jq('.mpp-lightbox-edit-media-link').show();jq('.mpp-lightbox-media-description').show();return!1});jq(document).on('click','.mpp-lightbox-edit-media-cancel-button',function(){var $this=jq(this);var $form=jq('#mpp-lightbox-media-edit-form-'+$this.data('mpp-media-id'));$form.addClass('mpp-form-hidden');jq('.mpp-lightbox-edit-media-cancel-link').hide();jq('.mpp-lightbox-edit-media-link').show();jq('.mpp-lightbox-media-description').show();return!1});jq(document).on('click','.mpp-lightbox-edit-media-submit-button',function(){var $btn_submit=jq(this);var $form=$btn_submit.parents('.mpp-lightbox-media-edit-form');var $btn_cancel=$form.find('.mpp-lightbox-edit-media-cancel-button');$form.find('.mpp-loader-image').show();$btn_submit.attr('disabled',!0);$btn_cancel.attr('disabled',!0);mpp_lightbox_hide_edit_error($form);var data=$form.serialize();data+='&action=mpp_update_lightbox_media';jq.post(ajaxurl,data,function(response){var magnificPopup=jQuery.magnificPopup.instance;if(response.success){var content=response.data.content;magnificPopup.currItem.src=content;magnificPopup.items[magnificPopup.index]=magnificPopup.currItem;magnificPopup.updateItemHTML()}else{var message=response.data.message;mpp_ligtbox_show_edit_error($form,message)}
$btn_submit.attr('disabled',!1);$btn_cancel.attr('disabled',!1);$form.find('.mpp-loader-image').hide()});return!1});function get_var_in_query(item,str){var items;if(typeof str==="undefined"||!str.length){return!1}
var data_fields=str.split('&');for(var i=0;i<data_fields.length;i++){items=data_fields[i].split('=');if(items[0]==item){return items[1]}}
return!1}
function get_var_in_url(item,url){var url_chunks=url.split('?');return get_var_in_query(item,url_chunks.length>1?url_chunks[1]:'')}});function mpp_mejs_activate(activity_id){var jq=jQuery;if(jq.fn.mediaelementplayer===undefined){return}
var settings={};if(typeof _wpmejsSettings!=='undefined'){settings=_wpmejsSettings}
settings.success=function(mejs){var autoplay,loop;if('flash'===mejs.pluginType){autoplay=mejs.attributes.autoplay&&'false'!==mejs.attributes.autoplay;loop=mejs.attributes.loop&&'false'!==mejs.attributes.loop;autoplay&&mejs.addEventListener('canplay',function(){mejs.play()},!1);loop&&mejs.addEventListener('ended',function(){mejs.play()},!1)}};jq('.wp-audio-shortcode, .wp-video-shortcode',jq('#activity-'+activity_id)).mediaelementplayer(settings);jq('.wp-playlist',jq('#activity-'+activity_id)).each(function(){return new WPPlaylistView({el:this})})}
function mpp_mejs_activate_lightbox_player(){var jq=jQuery;if(jq.fn.mediaelementplayer===undefined){return}
var settings={};if(typeof _wpmejsSettings!=='undefined'){settings=_wpmejsSettings}
settings.success=function(mejs){var autoplay,loop;if('flash'===mejs.pluginType){autoplay=mejs.attributes.autoplay&&'false'!==mejs.attributes.autoplay;loop=mejs.attributes.loop&&'false'!==mejs.attributes.loop;autoplay&&mejs.addEventListener('canplay',function(){mejs.play()},!1);loop&&mejs.addEventListener('ended',function(){mejs.play()},!1)}};jq('.wp-audio-shortcode, .wp-video-shortcode',jq('.mfp-content')).mediaelementplayer(settings);jq('.wp-playlist',jq('.mfp-content')).each(function(){return new WPPlaylistView({el:this})})}
;